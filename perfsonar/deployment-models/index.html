<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Deployment - OSG Networking Area</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Deployment";
    var mkdocs_page_input_path = "perfsonar/deployment-models.md";
    var mkdocs_page_url = "/perfsonar/deployment-models/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Networking Area</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">OSG Networking Area</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network Monitoring (perfSONAR)</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../perfsonar-in-osg/">Motivation</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Deployment</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#perfsonar-deployment-options">perfSONAR Deployment Options</a></li>
    

    <li class="toctree-l3"><a href="#perfsonar-hardware-requirements">perfSONAR Hardware Requirements</a></li>
    

    <li class="toctree-l3"><a href="#multiple-nic-network-interface-card-guidance">Multiple NIC (Network Interface Card) Guidance</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../installation/">Installation and Maintenance</a>
                </li>
                <li class="">
                    
    <a class="" href="../faq/">Frequently Asked Questions</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network Troubleshooting</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../network-troubleshooting/">Network Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../network-troubleshooting/osg-debugging-document/">OSG Network Debugging Document</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network Services</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../psetf/">Infrastructure Monitoring</a>
                </li>
                <li class="">
                    
    <a class="" href="../../osg-network-services/">Network Datastore and Streaming</a>
                </li>
                <li class="">
                    
    <a class="" href="../../osg-network-analytics/">Network Analytics</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Networking Area</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Network Monitoring (perfSONAR) &raquo;</li>
        
      
    
    <li>Deployment</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/networking/edit/master/docs/perfsonar/deployment-models.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="perfsonar-deployment-options">perfSONAR Deployment Options<a class="headerlink" href="#perfsonar-deployment-options" title="Permanent link">&para;</a></h3>
<p>The primary motivation for perfSONAR deployment is to test isolation, i.e. only one end-to-end test should run on a host at a time. This ensures that the test results are not impacted by the other tests. Otherwise it is much more difficult to interpret test results, which may vary due to host effects rather then network effects. Taking this into account it means that perfSONAR measurement tools are much more accurate running on a dedicated hardware and while it may be useful to run them on other hosts such as Data Transfer Nodes the current recommendation is to have specific measurement machine. In addition, as bandwidth testing could impact latency testing, we recommend to deploy two different nodes, each focused on specific set of tests. The following deployment options are currently available: </p>
<ul>
<li><strong>Bare metal</strong> - preffered option in one of two possible configurations:<ul>
<li>Two bare metal servers, one for latency node, one for bandwidth node</li>
<li>One bare metal server running both latency and bandwidth node together provided that there are two NICs available, please refer to <a href="#multiple-nic-network-interface-card-guidance">dual NIC</a> section for more details on this.</li>
</ul>
</li>
<li><strong>Virtual Machine</strong> - if bare metal is not available then it is also possible to run perfSONAR on a VM, however there are a set of additional requirements to fulfill:<ul>
<li>Full-node VM is strongly preffered, having 2 VMs (latency/bandwidth node) on a single bare metal. Mixing perfSONAR VM(s) with others might have an impact on the measurements and is therefore not recommended. </li>
<li>VM needs to be configured to have SR-IOV to NIC(s) as well as pinned CPUs to ensure bandwidth tests are not impacted (by hypervisor switching CPUs during the test)</li>
<li>Succesfull full speed local bandwidth test is highly recommended prior to putting the VM into production </li>
</ul>
</li>
<li><strong>Container</strong> - this is currently planned to be fully supported from version 4.1 (Q1 2018), but the main focus is on perfSONAR test point, which does not replace full toolkit installation as it doesn't include a local measurement archive and is therefore not recommeneded for WLCG/OSG use cases:<ul>
<li>Docker perfSONAR test instance can however still be used by sites that run multiple perfSONAR instances on site for their internal testing as this deployment model allows to flexibly deploy a test-point which can send results to a local measurement archive running on the perfSONAR toolkit node. </li>
</ul>
</li>
</ul>
<h3 id="perfsonar-hardware-requirements">perfSONAR Hardware Requirements<a class="headerlink" href="#perfsonar-hardware-requirements" title="Permanent link">&para;</a></h3>
<p>There are two different nodes participating in the network testing, latency node and bandwidth node, while both are running on the exact same perfSONAR toolkit, they have very different requirements. Bandwidth node measures available (or peak) throughput with low test frequency and will thus require NIC with high capacity (1/10/40/100G are supported, 10G is recommended) as well as enough memory and CPU to support high bandwidth testing. Latency node on the other hand runs low bandwidth, but high frequency tests, sending a continuous stream of packets to measure delay and corresponding packet loss, packet reordering, etc. This means that while it doesn't require high capacity NIC, 1G is usually sufficient, it can impose significant load on the IO to disk as well as CPU as many tests run in parallel and need to continuously store its results into local measurement archive. The official hardware requirements are documented at http://docs.perfsonar.net/install_hardware_details.html. For WLCG/OSG deployment, we recommend at least the following for perfSONAR 4.0+:</p>
<ul>
<li>10G NIC for bandwidth node, 1G NIC for latency node (for higher NIC capacities please check what CPU/RAM, PCIe speed are needed to achieve max. throughput)</li>
<li>4core x86_66 CPU (2.7 Ghz+) with at least 8GB of RAM (if both latency and bandwidth are on a single node than 16GB)</li>
<li>SSD disk (128GB should be sufficient)</li>
</ul>
<h3 id="multiple-nic-network-interface-card-guidance">Multiple NIC (Network Interface Card) Guidance<a class="headerlink" href="#multiple-nic-network-interface-card-guidance" title="Permanent link">&para;</a></h3>
<p>Many sites would prefer <strong>not</strong> to have to deploy two servers for cost, space and power reasons.  Since perfSONAR 3.5 there is a way to install both latency and bandwidth measurements services on a single node, as long as it has at least two NICs (one per 'flavor' of measurement) and sufficient processing and memory. There are few additional steps required in order to configure node with multiple network cards:</p>
<ul>
<li>Please setup source routing as described in the official documentation at http://docs.perfsonar.net/manage_dual_xface.html</li>
<li>You'll need to register two hostnames in <a href="../installation/">OIM</a>/<a href="../installation/">GOCDB</a> (and have two reverse DNS entries) as you would normally for two separate nodes</li>
<li>Instead of configuring just one auto-URL in the <code>/etc/perfsonar/meshconfig-agent.conf</code>, please add both, so you'll end up having something like this:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nt">&lt;mesh&gt;</span>
    configuration_url https://meshconfig.grid.iu.edu/pub/auto/<span class="nt">&lt;hostname_nic1&gt;</span>
    validate_certificate 0
    required 1
<span class="nt">&lt;/mesh&gt;</span>
<span class="nt">&lt;mesh&gt;</span>
    configuration_url https://meshconfig.grid.iu.edu/pub/auto/<span class="nt">&lt;hostname_nic2&gt;</span>
    validate_certificate 0
    required 1
<span class="nt">&lt;/mesh&gt;</span>
...
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../installation/" class="btn btn-neutral float-right" title="Installation and Maintenance">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../perfsonar-in-osg/" class="btn btn-neutral" title="Motivation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/networking/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../perfsonar-in-osg/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../installation/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
