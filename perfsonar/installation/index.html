<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Installation and Operations - OSG Networking Area</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Installation and Operations";
    var mkdocs_page_input_path = "perfsonar/installation.md";
    var mkdocs_page_url = "/perfsonar/installation/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Networking Area</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">OSG Networking Area</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network Monitoring (perfSONAR)</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../perfsonar-in-osg/">Motivation</a>
                </li>
                <li class="">
                    
    <a class="" href="../deployment-models/">Deployment</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Installation and Operations</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#perfsonar-installation-guide">perfSONAR Installation Guide</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#installation">Installation</a></li>
        
            <li><a class="toctree-l4" href="#security-considerations">Security Considerations</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../faq/">Frequently Asked Questions</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network Troubleshooting</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../network-troubleshooting/">Network Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../network-troubleshooting/osg-debugging-document/">OSG Network Debugging Document</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Network Services</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../psetf/">Infrastructure Monitoring</a>
                </li>
                <li class="">
                    
    <a class="" href="../../osg-network-services/">Network Datastore and Streaming</a>
                </li>
                <li class="">
                    
    <a class="" href="../../osg-network-analytics/">Network Analytics</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Networking Area</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Network Monitoring (perfSONAR) &raquo;</li>
        
      
    
    <li>Installation and Operations</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/networking/edit/master/docs/perfsonar/installation.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="perfsonar-installation-guide">perfSONAR Installation Guide<a class="headerlink" href="#perfsonar-installation-guide" title="Permanent link">&para;</a></h2>
<p>This page documents installing/upgrading <strong>perfSONAR</strong> for OSG and WLCG sites. In case this is the first time you're trying to install and integrate your perfSONAR into WLCG or OSG, please consult an <a href="perfsonar-in-osg.md">overview</a> and possible <a href="../deployment-models/">deployment options</a> before installing. For troubleshooting an existing installation please consult <a href="../faq/">FAQ</a>.</p>
<p>For any questions or help with WLCG perfSONAR setup, please contact <a href="https://wiki.egi.eu/wiki/GGUS:WLCG_perfSONAR_FAQ">GGUS</a> WLCG perfSONAR support unit or OSG <a href="">GOC</a>. We strongly recommend anyone maintaining/using perfSONAR to join <a href="https://lists.internet2.edu/sympa/subscribe/perfsonar-user">perfsonar-user</a> and <a href="https://lists.internet2.edu/sympa/subscribe/perfsonar-announce">perfsonar-announce</a> mailing lists.</p>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<p>Prior to installing please consult the <a href="http://docs.perfsonar.net/manage_update.html#special-upgrade-notes">release notes</a>. In case you have already an instance running and wish to update it then please consult our recommendations:</p>
<ul>
<li>For sites the are currently registered but not yet updated to 4.0 we would strongly recommend reinstalling using CentOS 7. The primary reason for this recommendation is that the next point release of perfSONAR (4.1) will no longer support RHEL6/CentOS6/Scientific Linux 6.</li>
<li>perfSONAR team provides support for Debian9 and Ubuntu as well, but we recommend to use CentOS7 as this is the most common and best understood deployment.</li>
<li>Please backup <code>/etc/perfsonar/meshconfig-agent.conf</code>, which contains the current configuration</li>
<li>Local measurement archive backup is not needed as OSG/WLCG stores all ,easurements centrally. In case you'd like to perform the backup  anyway please follow the <a href="http://docs.perfsonar.net/install_migrate_centos7.html">migration guide</a>.</li>
</ul>
<p>The following options are available to install perfSONAR toolkit:</p>
<table>
<thead>
<tr>
<th>Installation method</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Meta-package/bundle installation</td>
<td><a href="http://docs.perfsonar.net/install_centos.html">Bundle installation guide</a></td>
</tr>
<tr>
<td>Full ISO image installation</td>
<td><a href="http://docs.perfsonar.net/install_centos_fullinstall.html">Toolkit full install guide</a></td>
</tr>
<tr>
<td>Net ISO image installation</td>
<td><a href="http://docs.perfsonar.net/install_centos_netinstall.html">Toolkit NET install guide</a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In all cases, we <strong>strongly recommend to enable auto-updates</strong> during the installation process to keep the node up to date and        reboot it after critical kernel updates are announced. With <code>yum</code> auto-updates in place there is a possibility that updated packages     can "break" your perfSONAR install but this is viewed an acceptable risk in order to have security updates quickly applied on           perfSONAR instances. </p>
</div>
<p>The following <em>additional</em> steps are needed to configure the toolkit to be used in OSG/WLCG in addition to the steps described in the official guide:</p>
<ul>
<li>Please register your nodes in GOCDB/OIM. For OSG sites, follow the details in <a href="../register-ps-in-oim">OIM</a>. For non-OSG sites, follow the details in <a href="../register-ps-in-gocdb">GOCDB</a></li>
<li>Please ensure you have added or updated your <a href="http://docs.perfsonar.net/manage_admin_info.html">administrative information</a></li>
<li>Adding communities is optional, but we recommend putting in WLCG as well as your VO: <code>ATLAS</code>, <code>CMS</code>, etc. This just helps others from the community lookup your instances in the lookup service. As noted in the documentation you can select from already registered communities as appropriate.</li>
<li>You will need to configure your instance(s) to use the OSG/WLCG mesh-configuration. If this is a re-installation you can just revert from backup the file <code>/etc/perfsonar/meshconfig-agent.conf</code>. Otherwise please follow the steps below: <ul>
<li>Add a mesh section with configuration_url pointing to <code>http://meshconfig.grid.iu.edu/pub/auto/&lt;FQDN&gt;</code> Replace <code>&lt;FQDN&gt;</code> with the fully qualified domain name of your host, e.g., <code>psum01.aglt2.org</code>. Below is an example set of lines for <code>meshconfig-agent.conf</code>:</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span>       <span class="nt">&lt;mesh&gt;</span> 
         configuration_url http://meshconfig.grid.iu.edu/pub/auto/psum01.aglt2.org
         validate_certificate 0 
         required 1 
       <span class="nt">&lt;/mesh&gt;</span>  
</pre></div>


<ul>
<li>If this is a <strong>new instance</strong> or you have changed the nodes FQDN, you will need to notify <code>wlcg-perfsonar-support 'at' cern.ch</code> to add the node in one or more test meshes, which will then auto-configure the tests. You could also add any additional local tests via web interface or local mesh. Please indicate if you have preferences for which meshes your node should be included in (USATLAS, USCMS, ATLAS, CMS, LHCb, Alice, BelleII, HNSciCloud, etc.).</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Until your host is added (on http://meshconfig.grid.iu.edu ) to one or more meshes by a mesh-config administrator, the automesh configuration above won't be returning any tests (See registration information above).</p>
</div>
<ul>
<li>We <strong>recommend</strong> configuring perfSONAR in <strong>dual-stack mode</strong> (both IPv4 and IPv6). In case your site has IPv6 support, the only necessary step is to get both A and AAAA records for your perfSONAR DNS names (as well as ensuring the reverse DNS is in place).</li>
<li>Please check that both local and campus firewall has the necessary <a href="#security-considerations">port openings</a></li>
<li>Once installation is finished, please <strong>reboot</strong> the node.</li>
</ul>
<p>For any further questions, please consult <a href="../faq/">FAQ</a> pages, perfSONAR documentation (<a href="http://docs.perfsonar.net">http://docs.perfsonar.net</a>) or contact directly WLCG or OSG perfSONAR support units.</p>
<h3 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of the release of perfSONAR 4.0 ALL perfSONAR instances need to have port 443 access to all other perfSONAR instances. This change is because of the new requirements introduced by pScheduler. If sites are unable to reach your instance on port 443, tests may not run and results may not be available.</p>
</div>
<p>The perfSONAR toolkit is reviewed both internally and externally for security flaws. The toolkit's purpose is to allow us to measure and diagnose network problems and we therefore need to be cautious about blocking needed functionality by site or host firewalls.</p>
<p>For sites that are concerned about having port 443 open, there is a possiblity to get a list of hosts to/from which the tests will be initiated. However implementing the corresponding firewall rules would need to be done both locally and on the campus firewall. It's important to emphasize that port 443 provides access to the perfSONAR web interface and serves as a controller port for scheduling the tests, which is very useful to users and network administrators to debug network issues. Sites can optionally allow port 80, which could be restricted to a limited set of subnets, as shown in the rules below: </p>
<div class="codehilite"><pre><span></span>    # Port 443 must be open 
    iptables -I INPUT 4 -p tcp --dport 443 -j ACCEPT
    # Allow port 80 for specific monitoring subnets
    # OSG monitoring subnet 
    iptables -I INPUT 4 -p tcp --dport 80 -s 129.79.53.0/24 -j ACCEPT 
    # CERN subnet 
    iptables -I INPUT 4 -p tcp --dport 80 -s 137.138.0.0/17 -j ACCEPT 
    # Infrastructure monitoring (hosted at AGLT2) 
    iptables -I INPUT 4 -p tcp --dport 80 -s 192.41.231.110/32 -j ACCEPT 
    # Replace &lt;LOCAL\_SUBNET&gt; appropriately to allow access from your local systems 
    iptables -I INPUT 4 -p tcp --dport 80 -s &lt;LOCAL\_SUBNET&gt; -j ACCEPT 
    # Reject ONLY if your site policy requires this 
    #iptables -I INPUT 5 -p tcp --dport 80 -j REJECT
</pre></div>


<p>To save your changes run <code>/sbin/service iptables save</code> </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In case you have <strong>central/campus firewall</strong>, please check the required port openings in the <a href="http://docs.perfsonar.net/manage_security.html">perfSONAR security documentation</a>.  </p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../faq/" class="btn btn-neutral float-right" title="Frequently Asked Questions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../deployment-models/" class="btn btn-neutral" title="Deployment"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/networking/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../deployment-models/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../faq/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
